# ç«å±±å¼•æ“éƒ¨ç½²æŒ‡å—

## ğŸŒŸ ç«å±±å¼•æ“éƒ¨ç½²æ–¹æ¡ˆ

ç«å±±å¼•æ“æä¾›äº†å¤šç§éƒ¨ç½²æ–¹å¼ï¼Œä»¥ä¸‹æ˜¯é’ˆå¯¹AI Life Coachçš„æ¨èæ–¹æ¡ˆï¼š

### æ–¹æ¡ˆ1ï¼šå®¹å™¨æœåŠ¡TKEï¼ˆæ¨èï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒï¼‰
### æ–¹æ¡ˆ2ï¼šå‡½æ•°è®¡ç®—FCï¼ˆé€‚åˆæ— æœåŠ¡å™¨éƒ¨ç½²ï¼‰
### æ–¹æ¡ˆ3ï¼šäº‘æœåŠ¡å™¨ECSï¼ˆé€‚åˆç®€å•éƒ¨ç½²å’Œè‡ªå®šä¹‰é…ç½®ï¼‰

## ğŸ“‹ ç¯å¢ƒå˜é‡é…ç½®

åœ¨éƒ¨ç½²å‰ï¼Œè¯·å‡†å¤‡ä»¥ä¸‹ç¯å¢ƒå˜é‡ï¼š

| ç¯å¢ƒå˜é‡åç§° | æè¿° | å€¼ç¤ºä¾‹ |
|-------------|------|--------|
| `API_KEY` | ç«å±±æ–¹èˆŸAPIå¯†é’¥ | `4226d7c4-27c7-48f7-8254-3ce512187c61` |
| `API_URL` | ç«å±±æ–¹èˆŸAPIç«¯ç‚¹URL | `https://ark.cn-beijing.volces.com/api/v3/chat/completions` |
| `MODEL` | ä½¿ç”¨çš„AIæ¨¡å‹ | `deepseek-r1-250528` |
| `PORT` | æœåŠ¡å™¨ç«¯å£ | `3000` |

## æ–¹æ¡ˆ1ï¼šå®¹å™¨æœåŠ¡TKEéƒ¨ç½²

### æ­¥éª¤1ï¼šå‡†å¤‡Dockeré•œåƒ

1. **ç™»å½•ç«å±±å¼•æ“é•œåƒä»“åº“**
   ```bash
   docker login cr.volces.com -u ä½ çš„ç«å±±å¼•æ“è´¦å· -p ä½ çš„è®¿é—®å¯†é’¥
   ```

2. **æ„å»ºDockeré•œåƒ**
   ```bash
   cd D:\Life Coach new
   docker build -t cr.volces.com/ä½ çš„å‘½åç©ºé—´/ai-life-coach:v1 .
   ```

3. **æ¨é€Dockeré•œåƒ**
   ```bash
   docker push cr.volces.com/ä½ çš„å‘½åç©ºé—´/ai-life-coach:v1
   ```

### æ­¥éª¤2ï¼šåˆ›å»ºTKEé›†ç¾¤

1. ç™»å½•ç«å±±å¼•æ“æ§åˆ¶å°ï¼Œè¿›å…¥**å®¹å™¨æœåŠ¡TKE**
2. ç‚¹å‡»**é›†ç¾¤** â†’ **æ–°å»ºé›†ç¾¤**
3. é€‰æ‹©**æ ‡å‡†é›†ç¾¤**ï¼Œé…ç½®é›†ç¾¤å‚æ•°ï¼ˆæ ¹æ®éœ€æ±‚é€‰æ‹©èŠ‚ç‚¹è§„æ ¼ã€æ•°é‡ç­‰ï¼‰
4. ç­‰å¾…é›†ç¾¤åˆ›å»ºå®Œæˆ

### æ­¥éª¤3ï¼šéƒ¨ç½²åº”ç”¨

1. è¿›å…¥**å·¥ä½œè´Ÿè½½** â†’ **Deployment**
2. ç‚¹å‡»**æ–°å»º**ï¼Œé€‰æ‹©**ä½¿ç”¨é•œåƒåˆ›å»º**
3. é…ç½®Deploymentï¼š
   - **åç§°**ï¼šai-life-coach
   - **é•œåƒ**ï¼šcr.volces.com/ä½ çš„å‘½åç©ºé—´/ai-life-coach:v1
   - **å®¹å™¨ç«¯å£**ï¼š3000
   - **ç¯å¢ƒå˜é‡**ï¼šæ·»åŠ ä¸Šè¿°ç¯å¢ƒå˜é‡
4. ç‚¹å‡»**åˆ›å»º**

### æ­¥éª¤4ï¼šé…ç½®æœåŠ¡æš´éœ²

1. è¿›å…¥**æœåŠ¡** â†’ **æ–°å»ºæœåŠ¡**
2. é€‰æ‹©**ClusterIP**æˆ–**LoadBalancer**ï¼ˆå…¬ç½‘è®¿é—®å»ºè®®é€‰æ‹©LoadBalancerï¼‰
3. å…³è”åˆšæ‰åˆ›å»ºçš„Deployment
4. é…ç½®ç«¯å£æ˜ å°„ï¼š80 â†’ 3000
5. ç‚¹å‡»**åˆ›å»º**

## æ–¹æ¡ˆ2ï¼šå‡½æ•°è®¡ç®—FCéƒ¨ç½²

### æ­¥éª¤1ï¼šå‡†å¤‡éƒ¨ç½²åŒ…

1. **åˆ›å»ºéƒ¨ç½²ç›®å½•**
   ```bash
   mkdir -p fc-deploy
   ```

2. **å¤åˆ¶é¡¹ç›®æ–‡ä»¶**
   ```bash
   cp -r package*.json index.html script.js style.css server.js fc-deploy/
   cp .env.example fc-deploy/.env
   ```

3. **åˆ›å»ºå‡½æ•°å…¥å£æ–‡ä»¶**
   åœ¨fc-deployç›®å½•ä¸‹åˆ›å»º`index.js`ï¼š
   ```javascript
   const server = require('./server');
   
   // FCå…¥å£å‡½æ•°
   exports.handler = async (event, context, callback) => {
     return server.app(event, context, callback);
   };
   ```

4. **åˆ›å»ºtemplate.ymlé…ç½®æ–‡ä»¶**
   ```yaml
   ROSTemplateFormatVersion: '2015-09-01'
   Transform: 'Aliyun::Serverless-2018-04-03'
   Resources:
     ai-life-coach:
       Type: 'Aliyun::Serverless::Service'
       Properties:
         Description: 'AI Life Coach Service'
       ai-life-coach-function:
         Type: 'Aliyun::Serverless::Function'
         Properties:
           Handler: index.handler
           Runtime: nodejs18
           CodeUri: .
           EnvironmentVariables:
             API_KEY: 'ä½ çš„API_KEY'
             API_URL: 'https://ark.cn-beijing.volces.com/api/v3/chat/completions'
             MODEL: 'deepseek-r1-250528'
             PORT: '3000'
           MemorySize: 256
           Timeout: 60
         Events:
           httpTrigger:
             Type: HTTP
             Properties:
               AuthType: ANONYMOUS
               Methods:
                 - GET
                 - POST
   ```

### æ­¥éª¤2ï¼šéƒ¨ç½²åˆ°FC

1. **å®‰è£…FC CLI**
   ```bash
   npm install -g @alicloud/fc2
   ```

2. **éƒ¨ç½²å‡½æ•°**
   ```bash
   cd fc-deploy
   fc deploy
   ```

## æ–¹æ¡ˆ3ï¼šäº‘æœåŠ¡å™¨ECSéƒ¨ç½²

### æ­¥éª¤1ï¼šåˆ›å»ºECSå®ä¾‹

1. ç™»å½•ç«å±±å¼•æ“æ§åˆ¶å°ï¼Œè¿›å…¥**äº‘æœåŠ¡å™¨ECS**
2. ç‚¹å‡»**å®ä¾‹** â†’ **åˆ›å»ºå®ä¾‹**
3. é€‰æ‹©åˆé€‚çš„å®ä¾‹è§„æ ¼ï¼ˆæ¨è2æ ¸4Gä»¥ä¸Šï¼‰
4. é€‰æ‹©**CentOS 7.9**æˆ–**Ubuntu 20.04**é•œåƒ
5. é…ç½®ç½‘ç»œå’Œå®‰å…¨ç»„ï¼ˆå¼€æ”¾80å’Œ3000ç«¯å£ï¼‰
6. ç­‰å¾…å®ä¾‹åˆ›å»ºå®Œæˆ

### æ­¥éª¤2ï¼šè¿æ¥ECSå®ä¾‹

```bash
ssh root@ä½ çš„ECSå…¬ç½‘IP
```

### æ­¥éª¤3ï¼šå®‰è£…ä¾èµ–

**CentOS**ï¼š
```bash
yum update -y
yum install -y nodejs npm git
yum install -y nginx
```

**Ubuntu**ï¼š
```bash
apt update -y
apt install -y nodejs npm git
apt install -y nginx
```

### æ­¥éª¤4ï¼šéƒ¨ç½²åº”ç”¨

1. **å…‹éš†ä»£ç **
   ```bash
   git clone https://gitee.com/anna2020/life-coah-v1.git
   cd life-coah-v1
   ```

2. **å®‰è£…ä¾èµ–**
   ```bash
   npm install --production
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**
   ```bash
   cp .env.example .env
   # ä½¿ç”¨viæˆ–nanoç¼–è¾‘.envæ–‡ä»¶ï¼Œæ·»åŠ ä½ çš„API_KEYç­‰é…ç½®
   vi .env
   ```

4. **å¯åŠ¨æœåŠ¡**
   ```bash
   # ä½¿ç”¨PM2ç®¡ç†è¿›ç¨‹
   npm install -g pm2
   pm2 start server.js --name ai-life-coach
   pm2 save
   pm2 startup
   ```

5. **é…ç½®Nginxåå‘ä»£ç†**
   ```bash
   vi /etc/nginx/conf.d/ai-life-coach.conf
   ```
   
   è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š
   ```nginx
   server {
       listen 80;
       server_name ä½ çš„åŸŸåæˆ–å…¬ç½‘IP;
       
       location / {
           proxy_pass http://localhost:3000;
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection 'upgrade';
           proxy_set_header Host $host;
           proxy_cache_bypass $http_upgrade;
       }
   }
   ```

6. **é‡å¯Nginx**
   ```bash
   systemctl restart nginx
   ```

## ğŸŒŸ ç«å±±æ–¹èˆŸAPIé›†æˆä¼˜åŠ¿

éƒ¨ç½²åˆ°ç«å±±å¼•æ“æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

1. **ä½å»¶è¿Ÿ**ï¼šåŒåŒºåŸŸéƒ¨ç½²ï¼ŒAPIè°ƒç”¨å»¶è¿Ÿæ›´ä½
2. **é«˜å¯ç”¨**ï¼šç«å±±å¼•æ“æä¾›99.99%çš„å¯ç”¨æ€§ä¿éšœ
3. **å®‰å…¨ç¨³å®š**ï¼šä¼ä¸šçº§å®‰å…¨é˜²æŠ¤ï¼Œæ•°æ®ä¼ è¾“åŠ å¯†
4. **å¼¹æ€§æ‰©å±•**ï¼šæ ¹æ®æµé‡è‡ªåŠ¨æ‰©å±•èµ„æº
5. **æˆæœ¬ä¼˜åŒ–**ï¼šæŒ‰éœ€ä»˜è´¹ï¼Œèµ„æºåˆ©ç”¨ç‡æ›´é«˜

## ğŸ“¡ è®¿é—®åº”ç”¨

éƒ¨ç½²å®Œæˆåï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è®¿é—®AI Life Coachï¼š

- **TKE**ï¼šé€šè¿‡LoadBalancerçš„å…¬ç½‘IPæˆ–åŸŸåè®¿é—®
- **FC**ï¼šé€šè¿‡FCç”Ÿæˆçš„HTTPè§¦å‘å™¨URLè®¿é—®
- **ECS**ï¼šé€šè¿‡ECSçš„å…¬ç½‘IPæˆ–ç»‘å®šçš„åŸŸåè®¿é—®

## ğŸ”§ ç›‘æ§å’Œç»´æŠ¤

### ç«å±±å¼•æ“ç›‘æ§

1. **äº‘ç›‘æ§**ï¼šå®æ—¶ç›‘æ§CPUã€å†…å­˜ã€ç½‘ç»œç­‰æŒ‡æ ‡
2. **æ—¥å¿—æœåŠ¡**ï¼šæ”¶é›†å’Œåˆ†æåº”ç”¨æ—¥å¿—
3. **é“¾è·¯è¿½è¸ª**ï¼šè¿½è¸ªAPIè°ƒç”¨é“¾è·¯ï¼Œå®šä½é—®é¢˜

### å¸¸è§é—®é¢˜æ’æŸ¥

1. **APIè°ƒç”¨å¤±è´¥**ï¼šæ£€æŸ¥API_KEYå’ŒAPI_URLæ˜¯å¦æ­£ç¡®
2. **æœåŠ¡æ— æ³•è®¿é—®**ï¼šæ£€æŸ¥å®‰å…¨ç»„è§„åˆ™æ˜¯å¦å¼€æ”¾å¯¹åº”ç«¯å£
3. **å“åº”ç¼“æ…¢**ï¼šè€ƒè™‘å¢åŠ å®ä¾‹è§„æ ¼æˆ–ä½¿ç”¨è´Ÿè½½å‡è¡¡

## ğŸ‰ éƒ¨ç½²å®Œæˆ

æ­å–œä½ ï¼AI Life Coachå·²ç»æˆåŠŸéƒ¨ç½²åˆ°ç«å±±å¼•æ“ã€‚ç°åœ¨ä½ å¯ä»¥ï¼š

1. è®¿é—®åº”ç”¨ï¼Œå¼€å§‹ä½¿ç”¨AI Life Coach
2. é…ç½®åŸŸåå’ŒHTTPS
3. å¼€å¯ç›‘æ§å’Œå‘Šè­¦
4. æ ¹æ®éœ€æ±‚è°ƒæ•´èµ„æºé…ç½®

å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œæ¬¢è¿å‚è€ƒ[ç«å±±å¼•æ“æ–‡æ¡£](https://www.volcengine.com/docs)æˆ–è”ç³»ç«å±±å¼•æ“æŠ€æœ¯æ”¯æŒã€‚